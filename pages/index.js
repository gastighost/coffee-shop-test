import Head from 'next/head';
import Image from 'next/image';
import styles from '../styles/Home.module.css';
import Banner from '../components/banner';
import Card from '../components/card';

import { fetchKebabStores } from '../lib/kebab-stores';
import useTrackLocation from '../hooks/use-track-location';
import { useEffect } from 'react';

export async function getStaticProps(context) {
  const kebabStores = await fetchKebabStores();
  return {
    props: {
      kebabStores,
    },
  }
}

export default function Home(props) {
  const { handleTrackLocation, latLong, locationErrorMsg, isFindingLocation } = useTrackLocation();

  console.log({latLong, locationErrorMsg});
  const handleOnBannerBtnClick = () => {
    console.log("Hi Banner Button!")
    handleTrackLocation();
  }
  return (
    <div className={styles.container}>
      <Head>
        <title>DÃ¶ner Restaurants</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main className={styles.main}>
        <Banner buttonText={isFindingLocation ? "is loading..." : "Kebabs Nearby"}
                handleOnClick={handleOnBannerBtnClick}/>
        {locationErrorMsg && <p>Something went wrong: {locationErrorMsg}</p>}
        <div className={styles.heroImage}>
          <Image src="/static/kebab.png" width={250} height={210} alt="kebab" className="heroImage"/>
        </div>
        {props.kebabStores.length > 0 &&
        <div className={styles.sectionWrapper}>
          <h2 className={styles.heading2}>Berlin Stores</h2>
          <div className={styles.cardLayout}>
          {props.kebabStores.map((kebabStore) => {
                return (
                    <Card key={kebabStore.fsq_id}
                          name={kebabStore.name}
                          imgUrl={kebabStore.imgUrl}
                          href={`/doner-restaurant/${kebabStore.fsq_id}`}
                          className={styles.card}  />
                    )})}
          </div>
        </div>}
      </main>
    </div>
  )
}
